{% extends "base.html" %}

{% block title %}Listado de tareas{% endblock %}

{% block includes/breadcrumbs.html %}
<li class="breadcrumb-item active">Listado</li>
{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-bold">Tareas</h2>
    <a class="btn btn-primary" href="{% url 'crear' %}">
        <i class="fa-solid fa-plus me-1"></i> Crear Tarea
    </a>
</div>

<div class="card shadow-sm p-3 mb-4">
<form method="GET" class="row g-2">

    <div class="col-md-4">
        <input type="text" name="q" class="form-control"
            placeholder="Buscar tarea..."
            value="{{ request.GET.q }}">
    </div>

    <div class="col-md-2">
        <select name="estado" class="form-select">
            <option value="todos">Estado: Todos</option>
            <option value="pendiente" {% if request.GET.estado == "pendiente" %}selected{% endif %}>Pendiente</option>
            <option value="completada" {% if request.GET.estado == "completada" %}selected{% endif %}>Completada</option>
        </select>
    </div>

    <div class="col-md-2">
        <select name="prioridad" class="form-select">
            <option value="todas">Prioridad: Todas</option>
            <option value="baja" {% if request.GET.prioridad == "baja" %}selected{% endif %}>Baja</option>
            <option value="media" {% if request.GET.prioridad == "media" %}selected{% endif %}>Media</option>
            <option value="alta" {% if request.GET.prioridad == "alta" %}selected{% endif %}>Alta</option>
        </select>
    </div>

    <div class="col-md-2">
        <select name="categoria" class="form-select">
            <option value="todas">Categoría: Todas</option>
            {% for cat in categorias %}
                <option value="{{ cat.id }}" {% if request.GET.categoria == cat.id|stringformat:"s" %}selected{% endif %}>
                    {{ cat.nombre }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Aplicar</button>
    </div>

</form>
</div>

<div class="card shadow-sm">
    <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Título</th>
                    <th>Prioridad</th>
                    <th>Vence</th>
                    <th>Categoría</th>
                    <th>Estado</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                {% for tarea in tareas %}
                <tr>
                    <td class="fw-semibold">{{ tarea.titulo }}</td>

                    <td>
                        {% if tarea.prioridad == "alta" %}
                            <span class="badge bg-danger">
                                <i class="fa-solid fa-fire me-1"></i> Alta
                            </span>
                        {% elif tarea.prioridad == "media" %}
                            <span class="badge bg-warning text-dark">
                                <i class="fa-solid fa-circle-exclamation me-1"></i> Media
                            </span>
                        {% else %}
                            <span class="badge bg-primary">
                                <i class="fa-solid fa-arrow-down me-1"></i> Baja
                            </span>
                        {% endif %}
                    </td>

                    <td>
                        {% if tarea.fecha_vencimiento %}
                            {{ tarea.fecha_vencimiento|date:"d/m/Y H:i" }}
                        {% else %}
                            <span class="text-muted">Sin fecha</span>
                        {% endif %}
                    </td>

                    <td>{{ tarea.categoria|default:"-" }}</td>

                    <td>
                        <a href="{% url 'toggle_completada' tarea.id %}">
                            {% if tarea.estado == "completada" %}
                                <span class="btn btn-success btn-sm rounded-circle">
                                    <i class="fa-solid fa-check"></i>
                                </span>
                            {% else %}
                                <span class="btn btn-outline-secondary btn-sm rounded-circle">
                                    <i class="fa-regular fa-circle"></i>
                                </span>
                            {% endif %}
                        </a>
                    </td>

                    <td>
                        <a class="btn btn-outline-primary btn-sm" href="{% url 'detalle' tarea.id %}">
                            <i class="fa-solid fa-eye"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center text-muted py-3">No hay tareas que coincidan.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}